from numpy.ma import array
from torch import FloatTensor

from huggingmolecules.featurization.featurization_rmat import RMatBatchEncoding, RMatMoleculeEncoding

expected_encoded_smiles = [
    RMatMoleculeEncoding(
        node_features=array([[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                              0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.,
                              1., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0.,
                              0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0.,
                              0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.,
                              1., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]]),
        bond_features=array([[[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 1., 0., 0.],
                              [0., 1., 0., 0., 0.],
                              [0., 0., 0., 0., 1.],
                              [0., 0., 0., 1., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 1., 0.],
                              [0., 0., 1., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]],

                             [[0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.],
                              [0., 0., 0., 0., 0.]]]),
        distance_matrix=array([[1.00000000e+06, 1.00000000e+06, 1.00000000e+06, 1.00000000e+06, 1.00000000e+06],
                               [1.00000000e+06, 0.00000000e+00, 1.49726307e+00, 2.46955644e+00, 3.85851083e+00],
                               [1.00000000e+06, 1.49726307e+00, 0.00000000e+00, 1.33899508e+00, 2.46955692e+00],
                               [1.00000000e+06, 2.46955644e+00, 1.33899508e+00, 0.00000000e+00, 1.49726303e+00],
                               [1.00000000e+06, 3.85851083e+00, 2.46955692e+00, 1.49726303e+00, 0.00000000e+00]]),
        relative_matrix=array([[[1., 0., 0., 0., 0.],
                                [0., 1., 0., 0., 0.],
                                [0., 0., 1., 0., 0.],
                                [0., 0., 0., 1., 0.],
                                [0., 0., 0., 0., 1.]],

                               [[0., 0., 0., 0., 0.],
                                [0., 0., 1., 0., 0.],
                                [0., 1., 0., 1., 0.],
                                [0., 0., 1., 0., 1.],
                                [0., 0., 0., 1., 0.]],

                               [[0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0.],
                                [0., 0., 0., 0., 1.],
                                [0., 1., 0., 0., 0.],
                                [0., 0., 1., 0., 0.]],

                               [[0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 1.],
                                [0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0.],
                                [0., 1., 0., 0., 0.]],

                               [[0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0.]],

                               [[0., 1., 1., 1., 1.],
                                [1., 0., 0., 0., 0.],
                                [1., 0., 0., 0., 0.],
                                [1., 0., 0., 0., 0.],
                                [1., 0., 0., 0., 0.]]]),
        generated_features=None,
        y=None),
    RMatMoleculeEncoding(
        node_features=array([[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                              0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0.,
                              0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                             [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0.,
                              0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]]),
        bond_features=array([[[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 1.],
                              [0., 1., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]],

                             [[0., 0., 0.],
                              [0., 0., 0.],
                              [0., 0., 0.]]]),
        distance_matrix=array([[1.00000000e+06, 1.00000000e+06, 1.00000000e+06],
                               [1.00000000e+06, 0.00000000e+00, 1.21945472e+00],
                               [1.00000000e+06, 1.21945472e+00, 0.00000000e+00]]),
        relative_matrix=array([[[1., 0., 0.],
                                [0., 1., 0.],
                                [0., 0., 1.]],

                               [[0., 0., 0.],
                                [0., 0., 1.],
                                [0., 1., 0.]],

                               [[0., 0., 0.],
                                [0., 0., 0.],
                                [0., 0., 0.]],

                               [[0., 0., 0.],
                                [0., 0., 0.],
                                [0., 0., 0.]],

                               [[0., 0., 0.],
                                [0., 0., 0.],
                                [0., 0., 0.]],

                               [[0., 1., 1.],
                                [1., 0., 0.],
                                [1., 0., 0.]]]),
        generated_features=None,
        y=None)
]

expected_batch = RMatBatchEncoding(
    node_features=FloatTensor([[[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.,
                                 1., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.,
                                 1., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.]],

                               [[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
                                [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]]),
    bond_features=FloatTensor([[[[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 1., 0., 0.],
                                 [0., 1., 0., 0., 0.],
                                 [0., 0., 0., 0., 1.],
                                 [0., 0., 0., 1., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 1., 0.],
                                 [0., 0., 1., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]]],

                               [[[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 1., 0., 0.],
                                 [0., 1., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]],

                                [[0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.],
                                 [0., 0., 0., 0., 0.]]]]),
    relative_matrix=FloatTensor([[[[1., 0., 0., 0., 0.],
                                   [0., 1., 0., 0., 0.],
                                   [0., 0., 1., 0., 0.],
                                   [0., 0., 0., 1., 0.],
                                   [0., 0., 0., 0., 1.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 1., 0., 0.],
                                   [0., 1., 0., 1., 0.],
                                   [0., 0., 1., 0., 1.],
                                   [0., 0., 0., 1., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 1., 0.],
                                   [0., 0., 0., 0., 1.],
                                   [0., 1., 0., 0., 0.],
                                   [0., 0., 1., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 1.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 1., 0., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 1., 1., 1., 1.],
                                   [1., 0., 0., 0., 0.],
                                   [1., 0., 0., 0., 0.],
                                   [1., 0., 0., 0., 0.],
                                   [1., 0., 0., 0., 0.]]],

                                 [[[1., 0., 0., 0., 0.],
                                   [0., 1., 0., 0., 0.],
                                   [0., 0., 1., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 1., 0., 0.],
                                   [0., 1., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]],

                                  [[0., 1., 1., 0., 0.],
                                   [1., 0., 0., 0., 0.],
                                   [1., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.],
                                   [0., 0., 0., 0., 0.]]]]),
    distance_matrix=FloatTensor([[[1.0000e+06, 1.0000e+06, 1.0000e+06, 1.0000e+06, 1.0000e+06],
                                  [1.0000e+06, 0.0000e+00, 1.4973e+00, 2.4696e+00, 3.8585e+00],
                                  [1.0000e+06, 1.4973e+00, 0.0000e+00, 1.3390e+00, 2.4696e+00],
                                  [1.0000e+06, 2.4696e+00, 1.3390e+00, 0.0000e+00, 1.4973e+00],
                                  [1.0000e+06, 3.8585e+00, 2.4696e+00, 1.4973e+00, 0.0000e+00]],

                                 [[1.0000e+06, 1.0000e+06, 1.0000e+06, 0.0000e+00, 0.0000e+00],
                                  [1.0000e+06, 0.0000e+00, 1.2195e+00, 0.0000e+00, 0.0000e+00],
                                  [1.0000e+06, 1.2195e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00],
                                  [0.0000e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00],
                                  [0.0000e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00]]]),
    generated_features=None,
    y=None, batch_size=2)
